<!doctype html>
<html xmlns:ng="http://angularjs.org" id="ng-app" lang="en" ng-app="fantasyApp">
<head>
	<title>Medicare Reimbursment App</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
	

	
	<!-- STYLE SHEETS -->
	<link href='http://usatoday30.usatoday.com/maps/library/mapbox.css' rel='stylesheet' />
	<link rel="stylesheet" href="css/app.css"/>
	<link rel="stylesheet" href="lib/bootstrap/docs/assets/css/bootstrap.css" />
	<link rel="stylesheet" href="lib/bootstrap/docs/assets/css/bootstrap-responsive.css" />
	    <link rel="stylesheet" type="text/css" href="css/all_styles.css" />

	<style>
		body { margin:0; padding:0; }
		#map { height: 400px; width:100%; }
	</style>

	<!-- EXTERNAL JS FILES (more files located in the footer) -->
		<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
		<script src='http://usatoday30.usatoday.com/maps/library/mapbox.js'></script>
		<script src="http://usatoday30.usatoday.com/maps/library/leaflet-hash.js" type="text/javascript"></script>

		<script type="text/javascript" src="js/us-states.js"></script>
</head>

<body>



	<section class="content" ng-controller="CMS_controller">


		<div class="container">
			<div class="clearfix">
				<form id="search_json" class="margin_0 form-search span3">
					Zip Code:<br>
					<input id="zip_code" type="text" placeholder="Enter zip code" class="search-query span2" ng-model="searchTerm"> 
					<button type="submit" ng-click="search()">Search</button>
				</form>
				<div ng-show="data" class="span4">Doctor's Info:<br> <input ng-model="searchDr" placeholder="Name, address, or Specialty" class="span3 search-query"></div>

				<div ng-show="data" class="span4 ">Procedure: <br><input ng-model="searchProcedure" placeholder="Procedure name" class="search-query span3"></div>
			</div>
			<div class="clearfix margin_t20 margin_b20" ng-show="data"> <strong>Results: {{data.length}} health care providers in {{searchTerm}}</strong></div>


			<!-- {{data}}-->  

			<!-- Nav tabs -->
			<ul class="nav nav-tabs" ng-show="data">
				<li class="active"><a href="#table" data-toggle="tab">table</a></li>
				<li><a href="#graph" data-toggle="tab">graph</a></li>
				<li><a href="#map_tab1" data-toggle="tab">map</a></li>
			</ul>

			<!-- Tab panes -->
			<div class="tab-content" ng-show="data">
				<div class="tab-pane fade in active" id="table">
					<div class=""  ng-repeat="item in data | filter:searchProcedure | filter:searchDr" >
						<div class="row" ng-repeat = "provider in item.info"  ng-show="$first" class="">
							<!-- <button type="button" class="btn btn-default btn-small" data-toggle="" ><i class="icon-plus icon"></i></button> -->
							<div class="span10">
								<div class="row"><label class="span1 margin_l20px margin_t10 width_auto" ><input name="{{provider[0]}}" ng-model="compare" type="checkbox" class="icon-toggle"></label>
									<h4 class="provider_name span5 margin_t10" if="item.values[1]| filter:searchText">{{provider[1]}} {{provider[2]}} </h4>
									<span class="span4 margin_t10" ng-show="$first">{{provider[8]}}</span></div>


									<div class="provider_address margin_b20 span6" >{{provider[3]}} {{provider[4]}}, {{provider[5]}}, {{provider[6]}} {{provider[7]}}
									</div >
								</div>
								<div class="span2"><h5 ng-repeat="total in item.total_cost" ng-show="$first" class="pull-right">
									{{ sum(item.total_cost )| currency}}

								</h5></div>
							</div>

							<div class="row">
								<table class="table span12">
									<thead>
										<th>Procedure</th>
										<th>Patients</th>
										<th>Times Preformed</th>
										<th>Avg. Billed</th>
										<th>Avg. Reimbursed</th>
									</thead>
									<tbody>
										<tr ng-repeat = "value in item.values | filter:searchProcedure" >
											<td class="span4">{{value[1]}}<span class="hidden">{{value[0]}}</span></td>
											<td class="span2">{{value[2]}}</td>
											<td class="span2">{{value[3]}}</td>
											<td class="span2">{{value[4]  | currency}}</td>
											<td class="span2">{{value[5] | currency}}</td>
										</tr>
									</tbody>

								</table>
							</div>
						</div>
					</div>
					<div class="tab-pane  fade" id="graph">
						reimburse_graph: {{reimburse_graph}}<br>
						______________<br>
						myData: {{myData}} <br>
						_____________________<br>
						bob: {{bob}}<br>
						<div id ="graphContainer" ng-bargraph 
						datajson="bob"
						xaxis-name = "'Year'" 
						xaxis-pos = "905"  
						yaxis-name = "'Frequency'" 
						yaxis-pos = "6"></div>
					</div>
					<div class="tab-pane active fade in " id="map_tab1">
						
						    <div class='outter-wrap'>

						<!-- PROJECT HEAD -->
								<div class="head-wrap">
									<h2>Medicare Reimbursement</h2>
							        <p>State percentages by age and plan through March 1, 2014. State percentages by race through March 31, 2014</p>
							    </div>

						<!-- MAIN CONTENT -->
							    <div class='main-content-wrap'>
						            <div id='map-tabs'>
						                <ul class="tabs-inline main">
						                    <li id="c0" class="tabs-li active"><h5>Race  </h5></li>
						                    <li id="c1" class="tabs-li active"><h5>Age  </h5></li>
						                    <li id="c2" class="tabs-li active"><h5>Plan type</h5></li>
						                </ul>
						               <ul class="tabs-inline race">
						                    <li id="tr0" class="tabs-li hide"><h5>Indian  </h5></li>
						                    <li id="tr1" class="tabs-li       "><h5>Asian  </h5></li>
						                    <li id="tr2" class="tabs-li       "><h5>Hawaiian    </h5></li>
						                    <li id="tr3" class="tabs-li       "><h5>Black</h5></li>
						                    <li id="tr4" class="tabs-li       "><h5>Latino</h5></li>
						                    <li id="tr5" class="tabs-li       "><h5>White</h5></li>
						                    <li id="tr6" class="tabs-li last"><h5>Multi</h5></li> 
						                </ul>
						                <ul class="tabs-inline age">
						                    <li id="ta0" class="tabs-li"      ><h5>< 18  </h5></li>
						                    <li id="ta1" class="tabs-li       "><h5>18-25  </h5></li>
						                    <li id="ta2" class="tabs-li       "><h5>26-34    </h5></li>
						                    <li id="ta3" class="tabs-li       "><h5>35-44</h5></li>
						                    <li id="ta4" class="tabs-li       "><h5>45-54</h5></li>
						                    <li id="ta5" class="tabs-li       "><h5>55-64</h5></li>
						                    <li id="ta6" class="tabs-li last"><h5>> 64</h5></li>
						                </ul>
						                <ul class="tabs-inline plan">
						                    <li id="tpa0" class="tabs-li hide"><h5>Bronze </h5></li>
						                    <li id="tp1" class="tabs-li       "><h5>Silver   </h5></li>
						                    <li id="tp2" class="tabs-li       "><h5>Gold    </h5></li>
						                    <li id="tp3" class="tabs-li       "><h5>Platinum</h5></li>
						                    <li id="tp4" class="tabs-li last"><h5>Catastrophic </h5></li>
						                </ul>
						            </div>
									 <div id='map'></div>
								</div>


						<!-- FOOTER -->
								<div class='footer-wrap cf'>
									<!-- CREDITS LIST  --><h6><strong>Sources:</strong>HHS<br /><strong>Credits:</strong> Denny Gainer, Chad Palmer</h6>
									<!-- CREDITS/EXTRA INFO MODAL --><a href="#" class="credits_btn" data-reveal-id="credits_modal"></a>
								</div>

						<!-- MODALS -->
								<div id="credits_modal" class="reveal-modal">
						    	    <h5>Sources</h5>
						    	    <ul class='credits'>
						    	                    <li>Health and Human Services</li>
						   	                </ul>
						    	    <h5>Credits</h5>
						    	    <ul class='credits'>
						    	                    <li>Denny Gainer</li>
						    	                    <li>Chad Palmer</li>
						    	                </ul>
						    	    <a class="close-reveal-modal"></a>
						    	</div>

							</div>
					</div>
				</div>
				<div ng-show="data" class="container clearfix margin_t20 margin_b20"> 


				</div>




			</div>
	</section>


		<script src="lib/jquery/jquery.js"></script>
		<script src="lib/angular/angular.js"></script>
		<script src="lib/d3/d3.js" charset="utf-8"></script>
		<script src="lib/angular-resource/angular-resource.min.js"></script>
		<script src="lib/angular-bootstrap/ui-bootstrap-tpls.min.js"></script>
		<script src="lib/bootstrap/js/bootstrap-collapse.js"></script>
		<script src="lib/bootstrap/js/bootstrap-button.js"></script>
		<script src="lib/bootstrap/js/bootstrap-tab.js"></script>
		<script src="lib/angular-route/angular-route.min.js"></script>
		<script src="lib/angular-resource/angular-resource.min.js"></script>

		<script src="js/app.js"></script>
		<script src="js/config.js"></script>
		<script src="js/controllers/CMS_controller.js"></script>
		<script src="js/services/CMS_service.js"></script>
		<script src="js/directives/cmsdirective.js"></script>

		<!-- EXTERNAL JS FILES -->
		 	<script src="lib/reveal/jquery.reveal.js" type="text/javascript"></script>
		 	<script src="lib/modernizr/modernizr-2.6.1.min.js" type="text/javascript"></script>
		 	<script src="js/analytics.js" type="text/javascript"></script>
		 	<script src="lib/leaflet/leaflet-hash.js" type="text/javascript"></script>
		 	<script type="text/javascript">
		 		
		 		
		 		var intCurrentMap = 0;
		 		var intCurrentTab = 0;


		 		var map = L.mapbox.map('map', 'usatoday.map-m28xx5xa')
		 			.setView([37.8, -96], 4);
		 		map.options.minZoom = 2;
		 		map.options.maxZoom = 8;
		 		map.scrollWheelZoom.disable();

		 		// control that shows state info on hover
		 		var info = L.control({ position: 'bottomleft' });

		 		info.onAdd = function (map) {
		 			this._div = L.DomUtil.create('div', 'info');
		 			this.update();
		 			return this._div;
		 		};

		 		info.update = function (props) {
		 		    var strHTML = "", strCat;
		 		    if (props) {
		 		        switch (props.exchange) {
		 		            case 0:
		 		                strType = "Federal";
		 		                break;
		 		            case 1:
		 		                strType = "State";
		 		                break;
		 		            default:
		 		                strType = "NA"
		 		                break;
		 		        }

		 		        strHTML += '<h4>' + props.name + '</h4>';
		 		        strHTML += '<p>Exchange type: <b>' + strType + '</b></p>';
		 				 if (intCurrentMap == 0) {
		 					switch (intCurrentTab) {
		 						case 0:
		 							strCat = "Indian";
		 							break;
		 						case 1:
		 							strCat = "Asian";
		 							break;
		 						case 2:
		 							strCat = "Hawaiian";
		 							break;
		 						case 3:
		 							strCat = "Black";
		 							break;
		 						case 4:
		 							strCat = "Latino";
		 							break;
		 						case 5:
		 							strCat = "White";
		 							break;
		 						case 6:
		 							strCat = "Multi";
		 							break;
		 						default:
		 							strCat = "NA"
		 							break;
		 					}
		 					if (props.race[intCurrentTab] != -1) {
		 				 		strHTML += '<p><b>' + props.race[intCurrentTab] + '%</b> of total state ACA enrollees are ' + strCat + '</p>';
		 					} else {
		 						strHTML += '<p>No race data available for this state.</p>';
		 					}
		 				} else if (intCurrentMap == 1) {
		 					switch (intCurrentTab) {
		 						case 0:
		 							strCat = "less than 18";
		 							break;
		 						case 1:
		 							strCat = "18 to 25";
		 							break;
		 						case 2:
		 							strCat = "26 to 34";
		 							break;
		 						case 3:
		 							strCat = "35 to 44";
		 							break;
		 						case 4:
		 							strCat = "45 to 54";
		 							break;
		 						case 5:
		 							strCat = "55 to 64";
		 							break;
		 						case 6:
		 							strCat = "greater than 64";
		 							break;
		 						default:
		 							strCat = "NA"
		 							break;
		 					}
		 					if (props.age[intCurrentTab] != -1) {
		 				 		strHTML += '<p><b>' + props.age[intCurrentTab] + '%</b> of total state ACA enrollees are ' + strCat + ' years old.</p>';
		 					} else {
		 						strHTML += '<p>No age data available for this state.</p>';
		 					}
		 				 } else {
		 					switch (intCurrentTab) {
		 						case 0:
		 							strCat = "Bronze";
		 							break;
		 						case 1:
		 							strCat = "Silver";
		 							break;
		 						case 2:
		 							strCat = "Gold";
		 							break;
		 						case 3:
		 							strCat = "Platinum";
		 							break;
		 						case 4:
		 							strCat = "Catastrophic";
		 							break;
		 						default:
		 							strCat = "NA"
		 							break;
		 					}
		 					if (props.plan[intCurrentTab] != -1) {
		 				 		strHTML += '<p><b>' + props.plan[intCurrentTab] + '%</b> of total state ACA enrollees selected ' + strCat + ' plan.</p>';
		 					} else {
		 						strHTML += '<p>No plan data available for this state.</p>';
		 					}

		 				 }



		 		    } else {
		 		        strHTML += '<h4>ACA Enrollment</h4>';
		 		        strHTML += '<div class="boxChatter"><p>Rollover a state to see health care enrollment data for that state.</p></div>';
		 		    }
		 		    this._div.innerHTML = strHTML;
		 		};

		 		info.addTo(map);


		 		var legend = L.control({position: 'topright'});

		 		legend.onAdd = function (map) {

		 		    var div = L.DomUtil.create('div', 'info legend'),
		 				grades = [0, 11, 21, 31, 41, 51, 61, 71, 81, 91, -1],
		 				labels = [],
		 				level, strLevel;

		 		    for (var i = 0; i < grades.length; i++) {
		 		        level = grades[i];
		 		        switch (level) {
		 		            case 0:
		 		                strLevel = "0-10%";
		 		                break;
		 		            case 11:
		 		                strLevel = "11-20%";
		 		                break;
		 		            case 21:
		 		                strLevel = "21-30%";
		 		                break;
		 		            case 31:
		 		                strLevel = "31-40%";
		 		                break;
		 		            case 41:
		 		                strLevel = "41-50%";
		 		                break;
		 		            case 51:
		 		                strLevel = "51-60%";
		 		                break;
		 		            case 61:
		 		                strLevel = "61-70%";
		 		                break;
		 		            case 71:
		 		                strLevel = "71-80%";
		 		                break;
		 		            case 81:
		 		                strLevel = "81-90%";
		 		                break;
		 		            case 91:
		 		                strLevel = "91-100%";
		 		                break;
		 		            default:
		 		                strLevel = "NA"
		 		                break;
		 		        }

		 		        labels.push(
		 					'<div class="dots"><i style="background:' + getColor(level) + '"></i> ' +
		 					strLevel + '</div>');
		 		    }

		 		    div.innerHTML = labels.join('<br>');
		 		    return div;
		 		};

		 		legend.addTo(map);



		 		// get color depending on aca enrollment rate
		 		function getColor(d) {
		 			console.log(d);
		 			return d > 90 ? '#6a3d9a' :
		 			       d > 80 ? '#cab2d6' :
		 			       d > 70 ? '#ff7f00' :
		 			       d > 60 ? '#fdbf6f' :
		 			       d > 50 ? '#e31a1c' :
		 			       d > 40 ? '#fb9a99' :
		 			       d > 30 ? '#33a02c' :
		 			       d > 20 ? '#b2df8a' :
		 			       d > 10 ? '#1f78b4' :
		 			       d >= 0 ? '#a6cee3' :
		 			               '#ffffff';
		 		}

		 		function style(feature) {
		 			var arrValues = [];
		 			if (intCurrentMap == 0) {
		 				arrValues = feature.properties.race;
		 			} else if (intCurrentMap == 1) {
		 				arrValues = feature.properties.age;
		 			} else {
		 				arrValues = feature.properties.plan;
		 			}

		 			return {
		 				weight: 1,
		 				opacity: 1,
		 				color: '#666',
		 				//dashArray: '3',
		 				fillOpacity: 0.7,
		 				fillColor: getColor(arrValues[intCurrentTab])
		 			};
		 		}

		 		function highlightFeature(e) {
		 			var layer = e.target;

		 			layer.setStyle({
		 				//color: '#fff',
		 				dashArray: '',
		 				fillOpacity: 0.5
		 			});

		 			if (!L.Browser.ie && !L.Browser.opera) {
		 				layer.bringToFront();
		 			}

		 			info.update(layer.feature.properties);

		         }

		 		var geojson;

		 		function resetHighlight(e) {
		 			geojson.resetStyle(e.target);
		 			info.update();
		 			//$(".leaflet-top.leaflet-right").css({ 
		                 //"right": "0px",
		                 //"top": "0px"
		              //});
		 		}

		 		function zoomToFeature(e) {
		 			map.fitBounds(e.target.getBounds());
		 		}

		 		function onEachFeature(feature, layer) {
		 			layer.on({
		 			    mouseover: highlightFeature,
		 			    mouseout: resetHighlight,
		 				click: zoomToFeature
		             });
		            // $(layer).mousemove(function (event) {
		                 //$(".leaflet-top.leaflet-right").css({
		                     //"left": (event.originalEvent.layerPoint.x - 75).toString() + "px",
		                     //"top": (event.originalEvent.layerPoint.y - 70).toString() + "px",
		                     //"right": "auto"
		                 //});
		            // });
		 		}

		 		function renderData() {
		 			if (geojson) {
		 				map.removeLayer(geojson);
		 			}
		 			geojson = L.geoJson(statesData, {
		 			style: style,
		 			onEachFeature: onEachFeature
		 			}).addTo(map);
		 		}
		 		
		 		var arrMainTabs, arrRaceTabs, arrAgeTabs, arrPlanTabs; 
		 		
		 		function setupButtons() {
		 			arrMainTabs.click(function() {
		 				var _this = $(this);
		 				var _parent = _this.parent().find("li");
		 				changeMaps(_parent.index(_this));
		 			});
		 			arrRaceTabs.click(function() {
		 				var _this = $(this);
		 				var _parent = _this.parent().find("li");
		 				changeTabs(_parent.index(_this));
		 			});
		 			arrAgeTabs.click(function() {
		 				var _this = $(this);
		 				var _parent = _this.parent().find("li");
		 				changeTabs(_parent.index(_this));
		 			});
		 			arrPlanTabs.click(function() {
		 				var _this = $(this);
		 				var _parent = _this.parent().find("li");
		 				changeTabs(_parent.index(_this));
		 			});
		 			changeMaps(intCurrentMap);
		 		}
		 		
		 		function changeTabs(intIndex) {
		 			if (intCurrentMap == 0) {
		 				arrRaceTabs.removeClass("active").eq(intIndex).addClass("active");
		 			} else if (intCurrentMap == 1) {
		 				arrAgeTabs.removeClass("active").eq(intIndex).addClass("active");
		 			} else {
		 				arrPlanTabs.removeClass("active").eq(intIndex).addClass("active");
		 			}
		 			intCurrentTab = intIndex;
		 			renderData();
		 		}
		 		
		 		function changeMaps(intIndex) {
		 			arrMainTabs.removeClass("active").eq(intIndex).addClass("active");
		 			intCurrentMap = intIndex;
		 			if (intCurrentMap == 0) {
		 				arrRaceTabs.parent().removeClass("hide");
		 				arrAgeTabs.parent().addClass("hide");
		 				arrPlanTabs.parent().addClass("hide");
		 			} else if (intCurrentMap == 1) {
		 				arrRaceTabs.parent().addClass("hide");
		 				arrAgeTabs.parent().removeClass("hide");
		 				arrPlanTabs.parent().addClass("hide");
		 			} else   {
		 				arrRaceTabs.parent().addClass("hide");
		 				arrAgeTabs.parent().addClass("hide");
		 				arrPlanTabs.parent().removeClass("hide");				
		 			}
		 			changeTabs(0);
		 		}
		 		
		 		$(function() {
		   			arrMainTabs = $("ul.main").find("li");
		 			arrRaceTabs = $("ul.race").find("li");
		 			arrAgeTabs = $("ul.age").find("li");
		 			arrPlanTabs = $("ul.plan").find("li");
		 			setupButtons();
		 		});
		 		

		 		// map.attributionControl.addAttribution('Population data &copy; <a href="http://census.gov/">US Census Bureau</a>');


		 	</script>

	</body>
</html>
